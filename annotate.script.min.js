const e="load",t="click",o="update",n="cursorTypeChange",i="locationChange",a="keydown",r="toggleInbox";let c=!0,d="browse";const l=new Image;l.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNSAyNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjM3MzcgMjRMMTEuOTc5MiAyNEM1LjkxNTU0IDI0IDEgMTkuMDg0NSAxIDEzLjAyMDhMMSAxTDEyLjYyNjMgMUMxOC45MDc4IDEgMjQgNi4wOTIyIDI0IDEyLjM3MzdDMjQgMTguNzk0NyAxOC43OTQ3IDI0IDEyLjM3MzcgMjRaIiBmaWxsPSIjMjYyNjI2IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPGxpbmUgeDE9IjEyLjg3NSIgeTE9IjguNSIgeDI9IjEyLjg3NSIgeTI9IjE1LjI1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8bGluZSB4MT0iOS4xMjUiIHkxPSIxMS41IiB4Mj0iMTUuODc1IiB5Mj0iMTEuNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==";let s=[];import{finder as u}from"https://webapp.annotate.site/finder.js";import{createMirror as m,rebuild as f,snapshot as g}from"https://cdn.jsdelivr.net/npm/rrweb-snapshot@2.0.0-alpha.11/+esm";function p(){document.body.style.removeProperty("cursor");document.querySelectorAll("*").forEach((e=>{e.style.removeProperty("cursor")}));const e=document.getElementById("bounding-box");e&&document.body.removeChild(e)}function h(){document.body.style.setProperty("cursor","url('"+l.src+"'), auto","important");document.querySelectorAll("*").forEach((e=>{e.style.setProperty("cursor","url('"+l.src+"'), auto","important")}))}async function y(){p(),function(){const e=document.getElementById("bounding-box");e&&document.body.removeChild(e)}();const e=g(window.document,{keepIframeSrcFn:()=>!0,inlineStylesheet:!1,inlineImages:!1});if(!e)return;const t=document.implementation.createHTMLDocument("New Document");return f(e,{doc:t,mirror:m(),cache:{stylesWithHoverClass:new Map}})?(h(),t.documentElement.outerHTML):void 0}window.self===window.top&&(window.location.href="https://annotate.site/unavailable");const w=e=>u(e,{root:document,idName:()=>!0,className:e=>e.length>5,tagName:()=>!0,attr:()=>!1,seedMinLength:4,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5}),S=e=>u(e,{root:document,idName:()=>!1,className:()=>!1,tagName:()=>!0,attr:()=>!1,seedMinLength:6,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5});function b(e,t){window.top.postMessage(JSON.stringify({type:e,data:t}),"*")}function I(e){const t=s.filter((t=>t.route===e));setTimeout((()=>{const o=t.map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:-100,y:-100,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,tagName:t.tagName,xPercent:e.xPercent,yPercent:e.yPercent,route:window.location.pathname}}));b(i,{route:e||window.location.pathname,elementsPosition:o}),P()}),100)}var N,x;function M(){if(s&&s.length<=0)return;const e=s.filter((e=>{if(e)return e.route===window.location.pathname})).map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:e.x-window.scrollX,y:e.y-window.scrollY,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:o.width,offsetHeight:o.height,tagName:t.tagName}}));b(o,e)}function E(){"browse"===d?p():h()}function v(e){const t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}}N=window.history,x=N.pushState,I(window.location.pathname),N.pushState=function(e){return"function"==typeof N.onpushstate&&N.onpushstate({state:e}),setTimeout((function(){I(window.location.pathname)}),0),x.apply(N,arguments)},window.addEventListener("popstate",(function(){setTimeout((function(){I(window.location.pathname)}),0)})),window.addEventListener("hashchange",(function(){setTimeout((function(){I(window.location.pathname)}),0)})),window.addEventListener(e,(function(){b(e,{})})),document.addEventListener("mousemove",(function(e){const t=e.target;if("browse"===d)return;if(t.classList.contains("annotation-pin"))return;const o=t.getBoundingClientRect();let n=document.getElementById("bounding-box");n||(n=document.createElement("div"),n.setAttribute("id","bounding-box"),document.body.appendChild(n),n.style.position="absolute",n.style.border="2px dashed #f97316",n.style.zIndex=99999,n.style.pointerEvents="none"),n.style.top=v(t).top+"px",n.style.left=v(t).left+"px",n.style.width=o.width+"px",n.style.height=o.height+"px"})),window.addEventListener("message",(function(t){const o=JSON.parse(t.data);if(o.type===n)d=o.data.cursorType,E();else if(o.type===e){if(!o.data||o.data.length<=0)return;const e=o.data.map((e=>{let t=document.querySelector(e.parentSelector);return t||(t=function(e,t){const o=document.querySelector(e);return o?(b("updateParentSelector",{id:t,parentSelector:w(o)}),o):null}(e.fallbackSelector,e._id)),{parentSelector:e.parentSelector,node:t||null,xPercent:e.xPercent,yPercent:e.yPercent,route:e.route,fallbackSelector:e.fallbackSelector,x:e.x,y:e.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName}}));s=e,P(),M()}else if("add"===o.type){let e=document.querySelector(o.data.parentSelector);e||(e=S(o.data.fallbackSelector));const t=e.getBoundingClientRect(),n={parentSelector:o.data.parentSelector,node:e,xPercent:o.data.xPercent,yPercent:o.data.yPercent,route:o.data.route,fallbackSelector:o.data.fallbackSelector,x:t.x,y:t.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName};s.push(n),P()}else"Scroll"===o.type&&(o.data.route!==window.location.pathname?(window.location.pathname=o.data.route,I(o.data.route),b("ScrollToAnnotation",{parentSelector:o.data.parentSelector})):window.scrollTo({top:o.data.scrollY+window.scrollY,behavior:"smooth"}))})),window.addEventListener(t,(async function(e){if("browse"===d)return b(t,{isNew:!1}),!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const o="target"in e?e.target:e.srcElement,n=w(o),i=S(o),a=o.getBoundingClientRect(),r=(e.clientX-a.left)/a.width*100,l=(e.clientY-a.top)/a.height*100,u=window.scrollY,m=await y(),f={isNew:c,parentSelector:n,fallbackSelector:i,xPercent:r,yPercent:l,route:window.location.pathname,x:a.x,y:a.y,offsetWidth:a.width,offsetHeight:a.height,tagName:o.tagName,mousePosition:u,mouseClickX:e.clientX,mouseClickY:e.clientY,htmlContent:m};if(b(t,{...f}),0===s.length)s.push({...f,id:"NEW",node:o});else{const e=s.findIndex((e=>"NEW"===e.id));e>-1?s[e]={...f,id:"NEW",node:o}:s.push({...f,id:"NEW",node:o})}c=!c}),!0),window.addEventListener(a,(function(e){e.shiftKey&&"C"===e.key&&(b(n,{cursorType:"browse"===d?"comment":"browse"}),d="browse"===d?"comment":"browse",E()),e.shiftKey&&"I"===e.key&&b(r,{})})),window.addEventListener("scroll",(function(){M()})),window.addEventListener("resize",M);const P=()=>{new MutationObserver((e=>{if(e.some((e=>"bounding-box"===e.target.id||"BODY"===e.target.tagName&&("bounding-box"===e.addedNodes[0]?.id||"bounding-box"===e.removedNodes[0]?.id))))return!1;setTimeout((()=>{M()}),400)})).observe(window.document.body,{attributes:!0,childList:!0,subtree:!0})};