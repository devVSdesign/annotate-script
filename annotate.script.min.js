const e="load",t="click",o="update",n="cursorTypeChange",a="locationChange",i="keydown",r="toggleInbox",c="changePath";let d=!0,l="browse";const s=new Image;s.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNSAyNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjM3MzcgMjRMMTEuOTc5MiAyNEM1LjkxNTU0IDI0IDEgMTkuMDg0NSAxIDEzLjAyMDhMMSAxTDEyLjYyNjMgMUMxOC45MDc4IDEgMjQgNi4wOTIyIDI0IDEyLjM3MzdDMjQgMTguNzk0NyAxOC43OTQ3IDI0IDEyLjM3MzcgMjRaIiBmaWxsPSIjMjYyNjI2IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPGxpbmUgeDE9IjEyLjg3NSIgeTE9IjguNSIgeDI9IjEyLjg3NSIgeTI9IjE1LjI1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8bGluZSB4MT0iOS4xMjUiIHkxPSIxMS41IiB4Mj0iMTUuODc1IiB5Mj0iMTEuNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==";let u=[];import{finder as m}from"https://webapp.annotate.site/finder.js";import{createMirror as f,rebuild as g,snapshot as p}from"https://cdn.jsdelivr.net/npm/rrweb-snapshot@2.0.0-alpha.4/+esm";function h(){document.body.style.removeProperty("cursor");document.querySelectorAll("*").forEach((e=>{e.style.removeProperty("cursor")}));const e=document.getElementById("bounding-box");e&&document.body.removeChild(e)}function y(){document.body.style.setProperty("cursor","url('"+s.src+"'), auto","important");document.querySelectorAll("*").forEach((e=>{e.style.setProperty("cursor","url('"+s.src+"'), auto","important")}))}async function w(){h(),function(){const e=document.getElementById("bounding-box");e&&document.body.removeChild(e)}();const e=p(window.document,{keepIframeSrcFn:()=>!0,inlineStylesheet:!1,inlineImages:!1});if(!e)return;const t=document.implementation.createHTMLDocument("New Document");return g(e,{doc:t,mirror:f(),cache:{stylesWithHoverClass:new Map}})?(y(),t.documentElement.outerHTML):void 0}window.self===window.top&&(window.location.href="https://annotate.site/unavailable");const S=e=>m(e,{root:document,idName:()=>!0,className:e=>e.length>5,tagName:()=>!0,attr:()=>!1,seedMinLength:4,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5}),b=e=>m(e,{root:document,idName:()=>!1,className:()=>!1,tagName:()=>!0,attr:()=>!1,seedMinLength:6,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5});function I(e,t){window.top.postMessage(JSON.stringify({type:e,data:t}),"*")}function N(e){const t=u.filter((t=>t.route===e));setTimeout((()=>{const o=t.map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:-100,y:-100,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,tagName:t.tagName,xPercent:e.xPercent,yPercent:e.yPercent,route:window.location.pathname}}));I(a,{route:e||window.location.pathname,elementsPosition:o}),j()}),100)}var x,M;function E(){if(u&&u.length<=0)return;const e=u.filter((e=>{if(e)return e.route===window.location.pathname})).map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:e.x-window.scrollX,y:e.y-window.scrollY,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:o.width,offsetHeight:o.height,tagName:t.tagName}}));I(o,e)}function v(){"browse"===l?h():y()}function P(e){const t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}}x=window.history,M=x.pushState,N(window.location.pathname),x.pushState=function(e){return"function"==typeof x.onpushstate&&x.onpushstate({state:e}),setTimeout((function(){N(window.location.pathname)}),0),M.apply(x,arguments)},window.addEventListener("popstate",(function(){setTimeout((function(){N(window.location.pathname)}),0)})),window.addEventListener("hashchange",(function(){setTimeout((function(){N(window.location.pathname)}),0)})),window.addEventListener(e,(function(){I(e,{})})),document.addEventListener("mousemove",(function(e){const t=e.target;if("browse"===l)return;if(t.classList.contains("annotation-pin"))return;const o=t.getBoundingClientRect();let n=document.getElementById("bounding-box");n||(n=document.createElement("div"),n.setAttribute("id","bounding-box"),document.body.appendChild(n),n.style.position="absolute",n.style.border="2px dashed #f97316",n.style.zIndex=99999,n.style.pointerEvents="none"),n.style.top=P(t).top+"px",n.style.left=P(t).left+"px",n.style.width=o.width+"px",n.style.height=o.height+"px"})),window.addEventListener("message",(function(t){const o=JSON.parse(t.data);if(o.type===n)l=o.data.cursorType,v();else if(o.type===e){if(!o.data||o.data.length<=0)return;const e=o.data.map((e=>{let t=document.querySelector(e.parentSelector);return t||(t=function(e,t){const o=document.querySelector(e);return o?(I("updateParentSelector",{id:t,parentSelector:S(o)}),o):null}(e.fallbackSelector,e._id)),{parentSelector:e.parentSelector,node:t||null,xPercent:e.xPercent,yPercent:e.yPercent,route:e.route,fallbackSelector:e.fallbackSelector,x:e.x,y:e.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName}}));u=e,j(),E()}else if("add"===o.type){let e=document.querySelector(o.data.parentSelector);e||(e=b(o.data.fallbackSelector));const t=e.getBoundingClientRect(),n={parentSelector:o.data.parentSelector,node:e,xPercent:o.data.xPercent,yPercent:o.data.yPercent,route:o.data.route,fallbackSelector:o.data.fallbackSelector,x:t.x,y:t.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName};u.push(n),j()}else"Scroll"===o.type?o.data.route!==window.location.pathname?(window.location.pathname=o.data.route,N(o.data.route),I("ScrollToAnnotation",{parentSelector:o.data.parentSelector})):window.scrollTo({top:o.data.scrollY+window.scrollY,behavior:"smooth"}):o.type===c&&(a=o.data.path)&&a!==window.location.pathname&&(window.location.pathname=a);var a})),window.addEventListener(t,(async function(e){if("browse"===l)return I(t,{isNew:!1}),!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const o="target"in e?e.target:e.srcElement,n=S(o),a=b(o),i=o.getBoundingClientRect(),r=(e.clientX-i.left)/i.width*100,c=(e.clientY-i.top)/i.height*100,s=window.scrollY,m=await w(),f={isNew:d,parentSelector:n,fallbackSelector:a,xPercent:r,yPercent:c,route:window.location.pathname,x:i.x,y:i.y,offsetWidth:i.width,offsetHeight:i.height,tagName:o.tagName,mousePosition:s,mouseClickX:e.clientX,mouseClickY:e.clientY,htmlContent:m};if(I(t,{...f}),0===u.length)u.push({...f,id:"NEW",node:o});else{const e=u.findIndex((e=>"NEW"===e.id));e>-1?u[e]={...f,id:"NEW",node:o}:u.push({...f,id:"NEW",node:o})}d=!d}),!0),window.addEventListener(i,(function(e){e.shiftKey&&"C"===e.key&&(I(n,{cursorType:"browse"===l?"comment":"browse"}),l="browse"===l?"comment":"browse",v()),e.shiftKey&&"I"===e.key&&I(r,{})})),window.addEventListener("scroll",(function(){E()})),window.addEventListener("resize",E);const j=()=>{new MutationObserver((e=>{if(e.some((e=>"bounding-box"===e.target.id||"BODY"===e.target.tagName&&("bounding-box"===e.addedNodes[0]?.id||"bounding-box"===e.removedNodes[0]?.id))))return!1;setTimeout((()=>{E()}),400)})).observe(window.document.body,{attributes:!0,childList:!0,subtree:!0})};