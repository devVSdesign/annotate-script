const e="load",t="click",o="update",n="cursorTypeChange",i="locationChange",a="keydown",r="toggleInbox";let d=!0,c="browse";const l=new Image;l.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNSAyNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjM3MzcgMjRMMTEuOTc5MiAyNEM1LjkxNTU0IDI0IDEgMTkuMDg0NSAxIDEzLjAyMDhMMSAxTDEyLjYyNjMgMUMxOC45MDc4IDEgMjQgNi4wOTIyIDI0IDEyLjM3MzdDMjQgMTguNzk0NyAxOC43OTQ3IDI0IDEyLjM3MzcgMjRaIiBmaWxsPSIjMjYyNjI2IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPGxpbmUgeDE9IjEyLjg3NSIgeTE9IjguNSIgeDI9IjEyLjg3NSIgeTI9IjE1LjI1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8bGluZSB4MT0iOS4xMjUiIHkxPSIxMS41IiB4Mj0iMTUuODc1IiB5Mj0iMTEuNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==";let s=[];import{finder as u}from"https://medv.io/finder/finder.js";window.self===window.top&&(window.location.href="https://annotate.site/unavailable");const g=e=>u(e,{root:document,idName:()=>!0,className:e=>e.length>5,tagName:()=>!1,attr:()=>!1,seedMinLength:4,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5}),f=e=>u(e,{root:document,idName:()=>!1,className:()=>!1,tagName:()=>!1,attr:()=>!1,seedMinLength:6,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5});function m(e,t){window.top.postMessage(JSON.stringify({type:e,data:t}),"*")}function p(e){const t=s.filter((t=>t.route===e));setTimeout((()=>{const o=t.map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:-100,y:-100,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,tagName:t.tagName,xPercent:e.xPercent,yPercent:e.yPercent,route:window.location.pathname}}));m(i,{route:e||window.location.pathname,elementsPosition:o}),b()}),100)}var y,h;function w(){if(s&&s.length<=0)return;const e=s.filter((e=>{if(e)return e.route===window.location.pathname})).map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:e.x-window.scrollX,y:e.y-window.scrollY,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:o.width,offsetHeight:o.height,tagName:t.tagName}}));m(o,e)}function S(){if("browse"===c){const e=document.getElementById("bounding-box");e&&document.body.removeChild(e),document.body.style.removeProperty("cursor");document.querySelectorAll("*").forEach((e=>{e.style.removeProperty("cursor")}))}else{document.body.style.setProperty("cursor","url('"+l.src+"'), auto","important");document.querySelectorAll("*").forEach((e=>{e.style.setProperty("cursor","url('"+l.src+"'), auto","important")}))}}function I(e){const t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}}y=window.history,h=y.pushState,p(window.location.pathname),y.pushState=function(e){return"function"==typeof y.onpushstate&&y.onpushstate({state:e}),setTimeout((function(){p(window.location.pathname)}),0),h.apply(y,arguments)},window.addEventListener("popstate",(function(){setTimeout((function(){p(window.location.pathname)}),0)})),window.addEventListener("hashchange",(function(){setTimeout((function(){p(window.location.pathname)}),0)})),window.addEventListener(e,(function(){m(e,{})})),document.addEventListener("mousemove",(function(e){const t=e.target;if("browse"===c)return;if(t.classList.contains("annotation-pin"))return;const o=t.getBoundingClientRect();let n=document.getElementById("bounding-box");n||(n=document.createElement("div"),n.setAttribute("id","bounding-box"),document.body.appendChild(n),n.style.position="absolute",n.style.border="1px dashed gray",n.style.zIndex=99999,n.style.pointerEvents="none"),n.style.top=I(t).top+"px",n.style.left=I(t).left+"px",n.style.width=o.width+"px",n.style.height=o.height+"px"})),window.addEventListener("message",(function(t){const o=JSON.parse(t.data);if(o.type===n)c=o.data.cursorType,S();else if(o.type===e){if(!o.data||o.data.length<=0)return;const e=o.data.map((e=>{let t=document.querySelector(e.parentSelector);return t||(t=function(e,t){const o=document.querySelector(e);return o?(m("updateParentSelector",{id:t,parentSelector:g(o)}),o):null}(e.fallbackSelector,e._id)),{parentSelector:e.parentSelector,node:t||null,xPercent:e.xPercent,yPercent:e.yPercent,route:e.route,fallbackSelector:e.fallbackSelector,x:e.x,y:e.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName}}));s=e,b(),w()}else if("add"===o.type){let e=document.querySelector(o.data.parentSelector);e||(e=f(o.data.fallbackSelector));const t=e.getBoundingClientRect(),n={parentSelector:o.data.parentSelector,node:e,xPercent:o.data.xPercent,yPercent:o.data.yPercent,route:o.data.route,fallbackSelector:o.data.fallbackSelector,x:t.x,y:t.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName};s.push(n),b()}else"Scroll"===o.type&&(o.data.route!==window.location.pathname?(window.location.pathname=o.data.route,p(o.data.route),m("ScrollToAnnotation",{parentSelector:o.data.parentSelector})):window.scrollTo({top:o.data.scrollY+window.scrollY,behavior:"smooth"}))})),window.addEventListener(t,(function(e){if("browse"===c)return m(t,{isNew:!1}),!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const o="target"in e?e.target:e.srcElement,n=g(o),i=f(o),a=o.getBoundingClientRect(),r=(e.clientX-a.left)/a.width*100,l=(e.clientY-a.top)/a.height*100,u=window.scrollY,p={isNew:d,parentSelector:n,fallbackSelector:i,xPercent:r,yPercent:l,route:window.location.pathname,x:a.x,y:a.y,offsetWidth:a.width,offsetHeight:a.height,tagName:o.tagName,mousePosition:u,mouseClickX:e.clientX,mouseClickY:e.clientY};if(m(t,{...p}),0===s.length)s.push({...p,id:"NEW",node:o});else{const e=s.findIndex((e=>"NEW"===e.id));e>-1?s[e]={...p,id:"NEW",node:o}:s.push({...p,id:"NEW",node:o})}d=!d}),!0),window.addEventListener(a,(function(e){e.shiftKey&&"C"===e.key&&(m(n,{cursorType:"browse"===c?"comment":"browse"}),c="browse"===c?"comment":"browse",S()),e.shiftKey&&"I"===e.key&&m(r,{})})),window.addEventListener("scroll",(function(){w()})),window.addEventListener("resize",w);const b=()=>{new MutationObserver((e=>{if(e.some((e=>"bounding-box"===e.target.id||"BODY"===e.target.tagName&&("bounding-box"===e.addedNodes[0]?.id||"bounding-box"===e.removedNodes[0]?.id))))return!1;setTimeout((()=>{w()}),400)})).observe(window.document.body,{attributes:!0,childList:!0,subtree:!0})};