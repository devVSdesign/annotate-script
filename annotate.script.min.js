const e="load",t="click",o="update",n="cursorTypeChange",r="locationChange",a="keydown",i="toggleInbox";let c=!0,l="browse";const d=new Image;d.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNSAyNSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjM3MzcgMjRMMTEuOTc5MiAyNEM1LjkxNTU0IDI0IDEgMTkuMDg0NSAxIDEzLjAyMDhMMSAxTDEyLjYyNjMgMUMxOC45MDc4IDEgMjQgNi4wOTIyIDI0IDEyLjM3MzdDMjQgMTguNzk0NyAxOC43OTQ3IDI0IDEyLjM3MzcgMjRaIiBmaWxsPSIjMjYyNjI2IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiLz4KPGxpbmUgeDE9IjEyLjg3NSIgeTE9IjguNSIgeDI9IjEyLjg3NSIgeTI9IjE1LjI1IiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8bGluZSB4MT0iOS4xMjUiIHkxPSIxMS41IiB4Mj0iMTUuODc1IiB5Mj0iMTEuNSIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cg==";let s=[];import{finder as u}from"https://medv.io/finder/finder.js";window.self!==window.top||window.location.href.startsWith("data:text/html")||(window.location.href="https://annotate.site/unavailable");var f=function(e){var t=document.createElement("a");return t.href=e,t.href};function m(e){if(e instanceof HTMLElement){e.style.removeProperty("cursor");const t=e.children;for(let e=0;e<t.length;e++)m(t[e])}}export async function takeScreenShot(){var e=document.documentElement.cloneNode(!0);m(e);for(var t=e.getElementsByTagName("img"),o=0;o<t.length;o++)t[o].src=f(t[o]?.src);var n=e.getElementsByTagName("link");for(o=0;o<n.length;o++)n[o].href=f(n[o]?.href);e.style.pointerEvents="none",e.style.overflow="scroll",e.style.webkitUserSelect="none",e.style.userSelect="none",e.dataset.scrollX=`${window.scrollX}px`,e.dataset.scrollY=`${window.scrollY}px`;var r=new Blob([e.outerHTML],{type:"text/html"});return new Promise(((e,t)=>{var o=new FileReader;o.readAsDataURL(r),o.onloadend=function(){const t=o.result;e(t)},o.onerror=function(e){t(e)}}))}const g=e=>u(e,{root:document,idName:()=>!0,className:e=>e.length>5,tagName:()=>!0,attr:()=>!1,seedMinLength:4,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5}),h=e=>u(e,{root:document,idName:()=>!1,className:()=>!1,tagName:()=>!0,attr:()=>!1,seedMinLength:6,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e5});function y(e,t){window.top.postMessage(JSON.stringify({type:e,data:t}),"*")}function p(e){const t=s.filter((t=>t.route===e));setTimeout((()=>{const o=t.map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:-100,y:-100,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:t.offsetWidth,offsetHeight:t.offsetHeight,tagName:t.tagName,xPercent:e.xPercent,yPercent:e.yPercent,route:window.location.pathname}}));y(r,{route:e||window.location.pathname,elementsPosition:o}),N()}),100)}var w,S;function b(){if(s&&s.length<=0)return;const e=s.filter((e=>{if(e)return e.route===window.location.pathname})).map((e=>{let t=document.querySelector(e.parentSelector);if(t||(t=document.querySelector(e.fallbackSelector)),!t)return{parentSelector:e.parentSelector,x:e.x-window.scrollX,y:e.y-window.scrollY,offsetWidth:0,offsetHeight:0,tagName:""};const o=t.getBoundingClientRect();return{parentSelector:e.parentSelector,x:o.x,y:o.y,offsetWidth:o.width,offsetHeight:o.height,tagName:t.tagName}}));y(o,e)}function I(){if("browse"===l){const e=document.getElementById("bounding-box");e&&document.body.removeChild(e),document.body.style.removeProperty("cursor");document.querySelectorAll("*").forEach((e=>{e.style.removeProperty("cursor")}))}else{document.body.style.setProperty("cursor","url('"+d.src+"'), auto","important");document.querySelectorAll("*").forEach((e=>{e.style.setProperty("cursor","url('"+d.src+"'), auto","important")}))}}function x(e){const t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}}w=window.history,S=w.pushState,p(window.location.pathname),w.pushState=function(e){return"function"==typeof w.onpushstate&&w.onpushstate({state:e}),setTimeout((function(){p(window.location.pathname)}),0),S.apply(w,arguments)},window.addEventListener("popstate",(function(){setTimeout((function(){p(window.location.pathname)}),0)})),window.addEventListener("hashchange",(function(){setTimeout((function(){p(window.location.pathname)}),0)})),window.addEventListener(e,(function(){y(e,{})})),document.addEventListener("mousemove",(function(e){const t=e.target;if("browse"===l)return;if(t.classList.contains("annotation-pin"))return;const o=t.getBoundingClientRect();let n=document.getElementById("bounding-box");n||(n=document.createElement("div"),n.setAttribute("id","bounding-box"),document.body.appendChild(n),n.style.position="absolute",n.style.border="1px dashed gray",n.style.zIndex=99999,n.style.pointerEvents="none"),n.style.top=x(t).top+"px",n.style.left=x(t).left+"px",n.style.width=o.width+"px",n.style.height=o.height+"px"})),window.addEventListener("message",(function(t){const o=JSON.parse(t.data);if(o.type===n)l=o.data.cursorType,I();else if(o.type===e){if(!o.data||o.data.length<=0)return;const e=o.data.map((e=>{let t=document.querySelector(e.parentSelector);return t||(t=function(e,t){const o=document.querySelector(e);return o?(y("updateParentSelector",{id:t,parentSelector:g(o)}),o):null}(e.fallbackSelector,e._id)),{parentSelector:e.parentSelector,node:t||null,xPercent:e.xPercent,yPercent:e.yPercent,route:e.route,fallbackSelector:e.fallbackSelector,x:e.x,y:e.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName}}));s=e,N(),b()}else if("add"===o.type){let e=document.querySelector(o.data.parentSelector);e||(e=h(o.data.fallbackSelector));const t=e.getBoundingClientRect(),n={parentSelector:o.data.parentSelector,node:e,xPercent:o.data.xPercent,yPercent:o.data.yPercent,route:o.data.route,fallbackSelector:o.data.fallbackSelector,x:t.x,y:t.y,offsetWidth:e.offsetWidth,offsetHeight:e.offsetHeight,tagName:e.tagName};s.push(n),N()}else"Scroll"===o.type&&(o.data.route!==window.location.pathname?(window.location.pathname=o.data.route,p(o.data.route),y("ScrollToAnnotation",{parentSelector:o.data.parentSelector})):window.scrollTo({top:o.data.scrollY+window.scrollY,behavior:"smooth"}))})),window.addEventListener(t,(async function(e){if("browse"===l)return y(t,{isNew:!1}),!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const o="target"in e?e.target:e.srcElement,n=g(o),r=h(o),a=o.getBoundingClientRect(),i=(e.clientX-a.left)/a.width*100,d=(e.clientY-a.top)/a.height*100,u=window.scrollY,f=await takeScreenShot(),m={isNew:c,parentSelector:n,fallbackSelector:r,xPercent:i,yPercent:d,route:window.location.pathname,x:a.x,y:a.y,offsetWidth:a.width,offsetHeight:a.height,tagName:o.tagName,mousePosition:u,mouseClickX:e.clientX,mouseClickY:e.clientY,base64Screenshot:f};if(y(t,{...m}),0===s.length)s.push({...m,id:"NEW",node:o});else{const e=s.findIndex((e=>"NEW"===e.id));e>-1?s[e]={...m,id:"NEW",node:o}:s.push({...m,id:"NEW",node:o})}c=!c}),!0),window.addEventListener(a,(function(e){e.shiftKey&&"C"===e.key&&(y(n,{cursorType:"browse"===l?"comment":"browse"}),l="browse"===l?"comment":"browse",I()),e.shiftKey&&"I"===e.key&&y(i,{})})),window.addEventListener("scroll",(function(){b()})),window.addEventListener("resize",b);const N=()=>{new MutationObserver((e=>{if(e.some((e=>"bounding-box"===e.target.id||"BODY"===e.target.tagName&&("bounding-box"===e.addedNodes[0]?.id||"bounding-box"===e.removedNodes[0]?.id))))return!1;setTimeout((()=>{b()}),400)})).observe(window.document.body,{attributes:!0,childList:!0,subtree:!0})};